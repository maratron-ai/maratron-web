{"version":3,"names":["cov_ukxer3uxl","actualCoverage","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","useState","useCallback","useSession","userSchema","isYupValidationError","updateUser","useUserForm","initial","onSuccess","f","update","s","formData","setFormData","isEditing","setIsEditing","validationErrors","setValidationErrors","toggleEditing","handleChange","field","value","fd","handleSave","raw","id","valid","validate","abortEarly","stripUnknown","_ref","payload","_objectWithoutProperties","_excluded","updated","b","user","avatarUrl","console","error","err","inner","map","message"],"sources":["useUserForm.ts"],"sourcesContent":["import { useState, useCallback } from \"react\";\nimport { useSession } from \"next-auth/react\";\nimport userSchema from \"@lib/schemas/userSchema\";\nimport isYupValidationError from \"@lib/utils/validation/isYupValidationError\";\nimport { User } from \"@maratypes/user\";\nimport { updateUser } from \"@lib/api/user/user\";\n\nexport function useUserForm(\n  initial: User,\n  onSuccess: (u: User) => void\n) {\n  const { update } = useSession();\n  const [formData, setFormData] = useState<Partial<User>>(initial);\n  const [isEditing, setIsEditing] = useState(false);\n  const [validationErrors, setValidationErrors] = useState<string[]>([]);\n\n  const toggleEditing = useCallback(() => {\n    setValidationErrors([]);\n    setIsEditing((f) => !f);\n    setFormData(initial);\n  }, [initial]);\n\n  const handleChange = useCallback(\n    (field: keyof User, value: User[keyof User]) => {\n    setFormData((fd) => ({ ...fd, [field]: value }));\n  }, []);\n\n  const handleSave = useCallback(async () => {\n    setValidationErrors([]);\n    const raw = { id: initial.id, ...formData };\n    try {\n      const valid = await userSchema.validate(raw, {\n        abortEarly: false,\n        stripUnknown: true,\n      });\n      const { id, ...payload } = valid as { id: string } & Partial<User>;\n      const updated = await updateUser(id, payload);\n      onSuccess(updated);\n      if (update) {\n        try {\n          await update({ user: { avatarUrl: updated.avatarUrl ?? null } });\n        } catch (e) {\n          console.error(\"Failed to refresh session\", e);\n        }\n      }\n      setIsEditing(false);\n    } catch (err) {\n      if (isYupValidationError(err)) {\n        setValidationErrors(err.inner.map((e) => e.message));\n      } else {\n        console.error(err);\n      }\n    }\n  }, [formData, initial, onSuccess, update]);\n\n  return {\n    formData,\n    isEditing,\n    validationErrors,\n    toggleEditing,\n    handleChange,\n    handleSave,\n  };\n}\n"],"mappings":"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","ignoreList":[]}