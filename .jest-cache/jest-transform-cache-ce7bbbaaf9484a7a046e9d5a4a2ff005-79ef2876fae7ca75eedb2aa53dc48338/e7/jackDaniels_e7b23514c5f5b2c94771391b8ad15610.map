{"version":3,"names":["_paces","require","calculateVDOTJackDaniels","distanceMeters","timeSeconds","Error","timeMinutes","velocity","vo2MaxPercentage","Math","exp","vo2","pow","vdot","exports","ZONE_FACTORS","E","M","T","I","R","calculatePaceForVDOT","targetVDOT","zone","zonalVO2","low","high","mid","i","abs","metersPerMile","paceSec","formatPace","calculateGoalPaceForVDOT"],"sources":["jackDaniels.ts"],"sourcesContent":["import { formatPace } from \"@utils/running/paces\";\n\nexport const calculateVDOTJackDaniels = (\n  distanceMeters: number,\n  timeSeconds: number\n): number => {\n\n  if (distanceMeters <= 0 || timeSeconds <= 0) {\n    throw new Error(\"distance and time must be positive\");\n  }\n  \n  const timeMinutes = timeSeconds / 60;\n\n  const velocity = distanceMeters / timeMinutes;\n\n  const vo2MaxPercentage =\n    0.8 +\n    0.1894393 * Math.exp(-0.012778 * timeMinutes) +\n    0.2989558 * Math.exp(-0.1932605 * timeMinutes);\n\n  const vo2 = -4.6 + 0.182258 * velocity + 0.000104 * Math.pow(velocity, 2);\n\n  let vdot = vo2 / vo2MaxPercentage;\n\n  if (vdot > 100) vdot = 100; // cap VDOT at 100 for practical purposes\n  if (vdot < 20) vdot = 20; // minimum VDOT is 1\n\n  return vdot;\n};\n\ntype PaceZone = \"E\" | \"M\" | \"T\" | \"I\" | \"R\";\n\nconst ZONE_FACTORS: Record<PaceZone, number> = {\n  E: 0.7, // easy\n  M: 0.88, // marathon\n  T: 0.95, // threshold\n  I: 1.02, // interval\n  R: 1.08, // repetition\n};\n\n\n/**\n * Invert Daniels’ VO₂→pace model for a given zone.\n *\n * @param distanceMeters  Race distance in meters\n * @param targetVDOT      Runner’s VDOT\n * @param zone            One of \"E\",\"M\",\"T\",\"I\",\"R\"\n * @returns               Pace string \"mm:ss\" per mile\n */\nexport function calculatePaceForVDOT(\n  distanceMeters: number,\n  targetVDOT: number,\n  zone: PaceZone\n): string {\n  // adjust VO₂ for zone intensity\n  const zonalVO2 = targetVDOT * ZONE_FACTORS[zone];\n\n  // binary search bounds on race time (in seconds)\n  let low = distanceMeters / 10; // super-fast\n  let high = distanceMeters / 1; // super-slow\n  let mid = 0;\n\n  for (let i = 0; i < 50; i++) {\n    mid = (low + high) / 2;\n    const vo2 = calculateVDOTJackDaniels(distanceMeters, mid);\n    if (Math.abs(vo2 - zonalVO2) < 0.1) break;\n    if (vo2 < zonalVO2) {\n      // mid is too slow (VO₂ too low), speed up\n      high = mid;\n    } else {\n      // mid is too fast (VO₂ too high), slow down\n      low = mid;\n    }\n  }\n\n  // convert race time to pace per mile\n  const metersPerMile = 1609.34;\n  const paceSec = mid / (distanceMeters / metersPerMile);\n  return formatPace(paceSec);\n}\n\n/**\n * Predicts race-pace from a VDOT value for the given distance.\n * This is identical to `calculatePaceForVDOT` but without any\n * zone adjustment so the result represents goal pace.\n */\nexport function calculateGoalPaceForVDOT(\n  distanceMeters: number,\n  targetVDOT: number\n): string {\n  let low = distanceMeters / 10;\n  let high = distanceMeters;\n  let mid = 0;\n\n  for (let i = 0; i < 50; i++) {\n    mid = (low + high) / 2;\n    const vo2 = calculateVDOTJackDaniels(distanceMeters, mid);\n    if (Math.abs(vo2 - targetVDOT) < 0.1) break;\n    if (vo2 < targetVDOT) {\n      high = mid;\n    } else {\n      low = mid;\n    }\n  }\n\n  const metersPerMile = 1609.34;\n  const paceSec = mid / (distanceMeters / metersPerMile);\n  return formatPace(paceSec);\n}\n"],"mappings":"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","ignoreList":[]}