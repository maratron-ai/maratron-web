e5209120ab8f737735a79bb6f66685fd
/* istanbul ignore next */
function cov_279p5d06mx() {
  var path = "/Users/jacksonthetford/Desktop/maratron-monorepo/apps/web/src/app/api/upload/route.ts";
  var hash = "ce4c7fef60412a3d6b030bce71d176183bc67ba2";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/Users/jacksonthetford/Desktop/maratron-monorepo/apps/web/src/app/api/upload/route.ts",
    statementMap: {
      "0": {
        start: {
          line: 7,
          column: 19
        },
        end: {
          line: 7,
          column: 43
        }
      },
      "1": {
        start: {
          line: 8,
          column: 20
        },
        end: {
          line: 8,
          column: 40
        }
      },
      "2": {
        start: {
          line: 9,
          column: 2
        },
        end: {
          line: 11,
          column: 3
        }
      },
      "3": {
        start: {
          line: 10,
          column: 4
        },
        end: {
          line: 10,
          column: 73
        }
      },
      "4": {
        start: {
          line: 14,
          column: 15
        },
        end: {
          line: 14,
          column: 51
        }
      },
      "5": {
        start: {
          line: 16,
          column: 18
        },
        end: {
          line: 16,
          column: 72
        }
      },
      "6": {
        start: {
          line: 17,
          column: 2
        },
        end: {
          line: 19,
          column: 3
        }
      },
      "7": {
        start: {
          line: 18,
          column: 4
        },
        end: {
          line: 18,
          column: 78
        }
      },
      "8": {
        start: {
          line: 21,
          column: 2
        },
        end: {
          line: 23,
          column: 3
        }
      },
      "9": {
        start: {
          line: 22,
          column: 4
        },
        end: {
          line: 22,
          column: 75
        }
      },
      "10": {
        start: {
          line: 25,
          column: 16
        },
        end: {
          line: 25,
          column: 40
        }
      },
      "11": {
        start: {
          line: 26,
          column: 17
        },
        end: {
          line: 26,
          column: 35
        }
      },
      "12": {
        start: {
          line: 27,
          column: 20
        },
        end: {
          line: 27,
          column: 60
        }
      },
      "13": {
        start: {
          line: 28,
          column: 2
        },
        end: {
          line: 28,
          column: 46
        }
      },
      "14": {
        start: {
          line: 29,
          column: 19
        },
        end: {
          line: 29,
          column: 57
        }
      },
      "15": {
        start: {
          line: 30,
          column: 2
        },
        end: {
          line: 30,
          column: 53
        }
      },
      "16": {
        start: {
          line: 31,
          column: 2
        },
        end: {
          line: 31,
          column: 60
        }
      }
    },
    fnMap: {
      "0": {
        name: "POST",
        decl: {
          start: {
            line: 6,
            column: 22
          },
          end: {
            line: 6,
            column: 26
          }
        },
        loc: {
          start: {
            line: 6,
            column: 49
          },
          end: {
            line: 32,
            column: 1
          }
        },
        line: 6
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 9,
            column: 2
          },
          end: {
            line: 11,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 9,
            column: 2
          },
          end: {
            line: 11,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 9
      },
      "1": {
        loc: {
          start: {
            line: 9,
            column: 6
          },
          end: {
            line: 9,
            column: 48
          }
        },
        type: "binary-expr",
        locations: [{
          start: {
            line: 9,
            column: 6
          },
          end: {
            line: 9,
            column: 16
          }
        }, {
          start: {
            line: 9,
            column: 20
          },
          end: {
            line: 9,
            column: 48
          }
        }],
        line: 9
      },
      "2": {
        loc: {
          start: {
            line: 17,
            column: 2
          },
          end: {
            line: 19,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 17,
            column: 2
          },
          end: {
            line: 19,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 17
      },
      "3": {
        loc: {
          start: {
            line: 21,
            column: 2
          },
          end: {
            line: 23,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 21,
            column: 2
          },
          end: {
            line: 23,
            column: 3
          }
        }, {
          start: {
            line: undefined,
            column: undefined
          },
          end: {
            line: undefined,
            column: undefined
          }
        }],
        line: 21
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0
    },
    f: {
      "0": 0
    },
    b: {
      "0": [0, 0],
      "1": [0, 0],
      "2": [0, 0],
      "3": [0, 0]
    },
    _coverageSchema: "1a1c01bbd47fc00a2c39e90264f33305004495a9",
    hash: "ce4c7fef60412a3d6b030bce71d176183bc67ba2"
  };
  var coverage = global[gcv] || (global[gcv] = {});
  if (!coverage[path] || coverage[path].hash !== hash) {
    coverage[path] = coverageData;
  }
  var actualCoverage = coverage[path];
  {
    // @ts-ignore
    cov_279p5d06mx = function () {
      return actualCoverage;
    };
  }
  return actualCoverage;
}
cov_279p5d06mx();
import { NextResponse } from "next/server";
import { writeFile, mkdir } from "fs/promises";
import { join, extname } from "path";
import { randomUUID } from "crypto";
export async function POST(request) {
  /* istanbul ignore next */
  cov_279p5d06mx().f[0]++;
  const formData =
  /* istanbul ignore next */
  (cov_279p5d06mx().s[0]++, await request.formData());
  const fileEntry =
  /* istanbul ignore next */
  (cov_279p5d06mx().s[1]++, formData.get("file"));
  /* istanbul ignore next */
  cov_279p5d06mx().s[2]++;
  if (
  /* istanbul ignore next */
  (cov_279p5d06mx().b[1][0]++, !fileEntry) ||
  /* istanbul ignore next */
  (cov_279p5d06mx().b[1][1]++, !(fileEntry instanceof Blob))) {
    /* istanbul ignore next */
    cov_279p5d06mx().b[0][0]++;
    cov_279p5d06mx().s[3]++;
    return NextResponse.json({
      error: "File missing"
    }, {
      status: 400
    });
  } else
  /* istanbul ignore next */
  {
    cov_279p5d06mx().b[0][1]++;
  }

  // Treat the uploaded entry as a Blob with a name
  const file =
  /* istanbul ignore next */
  (cov_279p5d06mx().s[4]++, fileEntry);
  const allowed =
  /* istanbul ignore next */
  (cov_279p5d06mx().s[5]++, ["image/jpeg", "image/png", "image/webp", "image/gif"]);
  /* istanbul ignore next */
  cov_279p5d06mx().s[6]++;
  if (!allowed.includes(file.type)) {
    /* istanbul ignore next */
    cov_279p5d06mx().b[2][0]++;
    cov_279p5d06mx().s[7]++;
    return NextResponse.json({
      error: "Invalid file type"
    }, {
      status: 400
    });
  } else
  /* istanbul ignore next */
  {
    cov_279p5d06mx().b[2][1]++;
  }
  cov_279p5d06mx().s[8]++;
  if (file.size > 5 * 1024 * 1024) {
    /* istanbul ignore next */
    cov_279p5d06mx().b[3][0]++;
    cov_279p5d06mx().s[9]++;
    return NextResponse.json({
      error: "File too large"
    }, {
      status: 400
    });
  } else
  /* istanbul ignore next */
  {
    cov_279p5d06mx().b[3][1]++;
  }
  const bytes =
  /* istanbul ignore next */
  (cov_279p5d06mx().s[10]++, await file.arrayBuffer());
  const buffer =
  /* istanbul ignore next */
  (cov_279p5d06mx().s[11]++, Buffer.from(bytes));
  const uploadDir =
  /* istanbul ignore next */
  (cov_279p5d06mx().s[12]++, join(process.cwd(), "public", "uploads"));
  /* istanbul ignore next */
  cov_279p5d06mx().s[13]++;
  await mkdir(uploadDir, {
    recursive: true
  });
  const fileName =
  /* istanbul ignore next */
  (cov_279p5d06mx().s[14]++, `${randomUUID()}${extname(file.name)}`);
  /* istanbul ignore next */
  cov_279p5d06mx().s[15]++;
  await writeFile(join(uploadDir, fileName), buffer);
  /* istanbul ignore next */
  cov_279p5d06mx().s[16]++;
  return NextResponse.json({
    url: `/uploads/${fileName}`
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMjc5cDVkMDZteCIsImFjdHVhbENvdmVyYWdlIiwiTmV4dFJlc3BvbnNlIiwid3JpdGVGaWxlIiwibWtkaXIiLCJqb2luIiwiZXh0bmFtZSIsInJhbmRvbVVVSUQiLCJQT1NUIiwicmVxdWVzdCIsImYiLCJmb3JtRGF0YSIsInMiLCJmaWxlRW50cnkiLCJnZXQiLCJiIiwiQmxvYiIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImZpbGUiLCJhbGxvd2VkIiwiaW5jbHVkZXMiLCJ0eXBlIiwic2l6ZSIsImJ5dGVzIiwiYXJyYXlCdWZmZXIiLCJidWZmZXIiLCJCdWZmZXIiLCJmcm9tIiwidXBsb2FkRGlyIiwicHJvY2VzcyIsImN3ZCIsInJlY3Vyc2l2ZSIsImZpbGVOYW1lIiwibmFtZSIsInVybCJdLCJzb3VyY2VzIjpbInJvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCB7IHdyaXRlRmlsZSwgbWtkaXIgfSBmcm9tIFwiZnMvcHJvbWlzZXNcIjtcbmltcG9ydCB7IGpvaW4sIGV4dG5hbWUgfSBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IHsgcmFuZG9tVVVJRCB9IGZyb20gXCJjcnlwdG9cIjtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgY29uc3QgZm9ybURhdGEgPSBhd2FpdCByZXF1ZXN0LmZvcm1EYXRhKCk7XG4gIGNvbnN0IGZpbGVFbnRyeSA9IGZvcm1EYXRhLmdldChcImZpbGVcIik7XG4gIGlmICghZmlsZUVudHJ5IHx8ICEoZmlsZUVudHJ5IGluc3RhbmNlb2YgQmxvYikpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJGaWxlIG1pc3NpbmdcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xuICB9XG5cbiAgLy8gVHJlYXQgdGhlIHVwbG9hZGVkIGVudHJ5IGFzIGEgQmxvYiB3aXRoIGEgbmFtZVxuICBjb25zdCBmaWxlID0gZmlsZUVudHJ5IGFzIEJsb2IgJiB7IG5hbWU6IHN0cmluZyB9O1xuXG4gIGNvbnN0IGFsbG93ZWQgPSBbXCJpbWFnZS9qcGVnXCIsIFwiaW1hZ2UvcG5nXCIsIFwiaW1hZ2Uvd2VicFwiLCBcImltYWdlL2dpZlwiXTtcbiAgaWYgKCFhbGxvd2VkLmluY2x1ZGVzKGZpbGUudHlwZSkpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJJbnZhbGlkIGZpbGUgdHlwZVwiIH0sIHsgc3RhdHVzOiA0MDAgfSk7XG4gIH1cblxuICBpZiAoZmlsZS5zaXplID4gNSAqIDEwMjQgKiAxMDI0KSB7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiRmlsZSB0b28gbGFyZ2VcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xuICB9XG5cbiAgY29uc3QgYnl0ZXMgPSBhd2FpdCBmaWxlLmFycmF5QnVmZmVyKCk7XG4gIGNvbnN0IGJ1ZmZlciA9IEJ1ZmZlci5mcm9tKGJ5dGVzKTtcbiAgY29uc3QgdXBsb2FkRGlyID0gam9pbihwcm9jZXNzLmN3ZCgpLCBcInB1YmxpY1wiLCBcInVwbG9hZHNcIik7XG4gIGF3YWl0IG1rZGlyKHVwbG9hZERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gIGNvbnN0IGZpbGVOYW1lID0gYCR7cmFuZG9tVVVJRCgpfSR7ZXh0bmFtZShmaWxlLm5hbWUpfWA7XG4gIGF3YWl0IHdyaXRlRmlsZShqb2luKHVwbG9hZERpciwgZmlsZU5hbWUpLCBidWZmZXIpO1xuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyB1cmw6IGAvdXBsb2Fkcy8ke2ZpbGVOYW1lfWAgfSk7XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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