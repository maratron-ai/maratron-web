{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","CommentSection","_react","_interopRequireWildcard","_defineProperty2","_useSocialProfile","_social","_ui","_image","_link","_lucideReact","_jsxFileName","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","has","get","set","hasOwnProperty","call","getOwnPropertyDescriptor","__jsx","createElement","ownKeys","keys","getOwnPropertySymbols","filter","enumerable","push","apply","_objectSpread","arguments","length","forEach","getOwnPropertyDescriptors","defineProperties","postId","initialCount","onCommentAdded","profile","useSocialProfile","comments","setComments","useState","text","setText","loading","setLoading","submitting","setSubmitting","open","setOpen","count","setCount","fetchComments","useCallback","data","listComments","useEffect","onSubmit","preventDefault","trim","comment","addComment","id","c","socialProfile","className","__self","__source","fileName","lineNumber","columnNumber","Button","size","variant","onClick","MessageCircle","Fragment","Spinner","map","key","src","avatarUrl","alt","username","width","height","href","Input","onChange","target","placeholder","type","disabled"],"sources":["CommentSection.tsx"],"sourcesContent":["\"use client\";\nimport { useEffect, useState, FormEvent, useCallback } from \"react\";\nimport { useSocialProfile } from \"@hooks/useSocialProfile\";\nimport { listComments, addComment } from \"@lib/api/social\";\nimport type { Comment } from \"@maratypes/social\";\nimport { Button, Input, Spinner } from \"@components/ui\";\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { MessageCircle } from \"lucide-react\";\n\ninterface Props {\n  postId: string;\n  initialCount?: number;\n  onCommentAdded?: () => void;\n}\n\nexport default function CommentSection({\n  postId,\n  initialCount = 0,\n  onCommentAdded,\n}: Props) {\n  const { profile } = useSocialProfile();\n  const [comments, setComments] = useState<Comment[]>([]);\n  const [text, setText] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [submitting, setSubmitting] = useState(false);\n  const [open, setOpen] = useState(false);\n  const [count, setCount] = useState(initialCount);\n\n  const fetchComments = useCallback(async () => {\n    setLoading(true);\n    try {\n      const data = await listComments(postId);\n      setComments(data);\n    } finally {\n      setLoading(false);\n    }\n  }, [postId]);\n\n  useEffect(() => {\n    if (open) {\n      fetchComments();\n    }\n  }, [open, fetchComments]);\n\n  const onSubmit = async (e: FormEvent<HTMLFormElement>) => {\n    e.preventDefault();\n    if (!profile || !text.trim()) return;\n    setSubmitting(true);\n    try {\n      const comment = await addComment(postId, profile.id, text.trim());\n      setComments((c) => [...c, { ...comment, socialProfile: profile }]);\n      setCount((c) => c + 1);\n      onCommentAdded?.();\n      setText(\"\");\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-2\">\n      <Button\n        size=\"sm\"\n        variant={open ? \"secondary\" : \"outline\"}\n        onClick={() => setOpen((o) => !o)}\n        className=\"\n          flex items-center gap-1\n          text-foreground bg-transparent\n          transition-colors\n          hover:bg-transparent hover:ring-0\n          border-none\n          focus:outline-none focus:ring-0\n          focus-visible:outline-none focus-visible:ring-0\n        \"\n      >\n        <MessageCircle className=\"w-4 h-4\" />\n        {count}\n      </Button>\n      {open && (\n        <>\n          {loading ? (\n            <div className=\"flex justify-center py-2\">\n              <Spinner className=\"h-3 w-3\" />\n            </div>\n          ) : (\n            comments.map((c) => (\n              <div key={c.id} className=\"flex items-start gap-2 text-sm\">\n                <Image\n                  src={c.socialProfile?.avatarUrl || \"/default_profile.png\"}\n                  alt={c.socialProfile?.username || \"avatar\"}\n                  width={24}\n                  height={24}\n                  className=\"w-6 h-6 rounded-full object-cover border border-brand-to bg-brand-from\"\n                />\n                <p>\n                  {c.socialProfile?.username ? (\n                    <Link\n                      href={`/u/${c.socialProfile.username}`}\n                      className=\"font-semibold hover:underline\"\n                    >\n                      {c.socialProfile.username}\n                    </Link>\n                  ) : (\n                    <span className=\"font-semibold\">{c.socialProfile?.username}</span>\n                  )}{\" \"}\n                  {c.text}\n                </p>\n              </div>\n            ))\n          )}\n          {profile && (\n            <form onSubmit={onSubmit} className=\"flex gap-2 mt-2\">\n              <Input\n                value={text}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  setText(e.target.value)\n                }\n                placeholder=\"Add a comment\"\n                className=\"h-8\"\n              />\n              <Button\n                type=\"submit\"\n                size=\"sm\"\n                disabled={submitting || !text.trim()}\n              >\n                Post\n              </Button>\n            </form>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]}